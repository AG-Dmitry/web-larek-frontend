# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс информации о заказе

```
export interface IOrderInfo {
	payment: PaymentMethod | null;
	email: string;
	phone: string;
	address: string;
	total?: number;
	items?: string[];
}
```

Интерфейс данных товара

```
export interface IItem {
	id: string;
	title: string;
	category: string;
	description: string;
	price: number | null;
	image: string;
}
```

Перечисление типов методов оплаты

```
export enum PaymentMethod {
	Online = 'online',
	UponReceipt = 'upon receipt'
}
```

Перечисление типов категорий товаров

```
export enum Category {
	Misc = 'дополнительное',
	Other = 'другое',
	Button = 'кнопка',
	SoftSkill = 'софт-скил',
	HardSkill = 'хард-скил'
}
```

Тип данных информации о заказе, используемый в формах при оформлении заказа

```
export type TFormOrderInfo = Pick<IOrderInfo, 'paymentMethod' | 'email' | 'phone' | 'address'>;
```

Тип данных товара, используемый в корзине

```
export type TBasketItem = Pick<IItem, 'id' | 'title' | 'category' | 'price'>;
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер.
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие.
- `off` - сброс обработчика события.
- `emit` - инициализация события.
- `on all` - подписка на все события брокера.
- `off all` - сброс всех обработчиков событий брокера.
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс OrderInfoData
Класс отвечает за хранение и логику работы с данными о текущем заказе.

В полях класса хранятся следующие данные:
- `paymentMethod: PaymentMethod` - способ оплаты.
- `email: string` - электронная почта.
- `phone: string` - телефон.
- `address: string` - адрес доставки.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- `constructor()` - конструктор создает объект для хранения данных о заказе. Класс расширяет `EventEmitter` для инициации событий.
- `getData(): TOrderInfo` - возвращает данные о текущем заказе.
- `setData(key: keyof IUser, value: string): void` - сохраняет данные заказа в экземпляре класса и вызывает событие изменения данных.
- `validateOrder(): boolean` - проверяет объект с данными заказа на наличие выбранного способа оплаты и заполненного адреса доставки.
- `validateAll(): boolean` - вызывает проверку по методу `validateOrder()`, а также проверяет объект с данными заказа на наличие указанных телефона и электронной почты.

#### Класс CatalogData
Класс отвечает за хранение и логику работы с данными товаров, загружаемых с сервера.

В полях класса хранятся следующие данные:
- `items: ICard[]` - массив объектов товаров.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- `constructor()` - конструктор создает объект для хранения данных о всех товарах магазина. Класс расширяет `EventEmitter` для инициации событий.
- `addItem(item: IItem): void` - добавляет один товар в конец массива и вызывает событие изменения массива.
- `getItem(id: string): IItem` - возвращает товар по его id.
- `getItemsAll(): IItem[]` - возвращает массив всех товаров в каталоге.

#### Класс BasketData
Класс отвечает за хранение и логику работы с данными товаров в корзине пользователя.

В полях класса хранятся следующие данные:
- `items: ICard[]` - массив объектов товаров.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- `constructor()` - конструктор создает объект для хранения данных о товарах, добавленных пользователем в свою корзину. Класс расширяет `EventEmitter` для инициации событий.
- `addItem(item: IItem): void` - добавляет один товар в конец массива корзины и вызывает событие изменения массива.
- `removeItem(id: string): void` - удаляет товар из массива корзины по его id.
- `removeItemsAll(): void` - очищает все товары из корзины.
- `getItem(id: string): IItem` - возвращает товар по его id.
- `getItemsIdList(): string[]` - возвращает id всех товаров в массиве корзины.
- `getItemsCount(): number` - возвращает количество товаров в массиве корзины.
- `getTotalPrice(): number` - возвращает стоимость всех товаров в массиве корзины.
- `checkValidation(data: Record<keyof TItem, string>): boolean` - проверяет объект с данными товара на валидность перед отправкой на сервер.

### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс BasketButton
Отвечает за отображение иконки корзины с количеством товаров в корзине в хедере сайта.

Методы:
- `constructor(element: HTMLButtonElement)` - конструктор принимает элемент типа button, по которому в разметке страницы будет идентифицирована кнопка с иконкой корзины. Класс расширяет `EventEmitter` для инициации событий.

Поля класса:
- `button: HTMLButtonElement` - кнопка с иконкой корзины.
- `counter: HTMLElement` - элемент, отображающий количество товаров в корзине.

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице.

Методы:
- `constructor(element: HTMLElement)` - конструктор принимает контейнер, в котором размещаются карточки.
- `updateContainer(): void` - обновляет содержимое контейнера.

Поля класса:
- `container: HTMLElement` - элемент контейнера карточек.

#### Класс Card
Абстрактный класс. Отвечает за отображение карточки товара, задавая в карточке данные названия, категории, описания товара, цены и изображения. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент, созданный по темплейту, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.

Методы:
- `constructor(item: IItem, element: HTMLButtonElement)` - метод создает полностью заполненную карточку. Класс расширяет `EventEmitter` для инициации событий.
- `render(): HTMLElement` - метод возвращает карточку.

Поля класса:
- `card: HTMLElement` - элемент карточки товара полученный из темплейта.
- `id: string` - уникальный идентификатор товара.
- `category: HTMLElement` - элемент категории товара в карточке.
- `categotyClass: string` - строка содержащая информацию о CSS классе, добавляемом к элементу категории товара при создании карточки.
- `title: HTMLElement` - элемент заголовка товара в карточке.
- `text: HTMLElement` - элемент описания товара в карточке.
- `image: HTMLImageElement` - элемент изображения товара в карточке.
- `price: HTMLElement` - элемент цены товара в карточке.
- `button: HTMLButtonElement` - произвольный элемент кнопки карточки.


#### Класс CardMain
Класс для отображения карточек товара на главной странице. Расширяет класс `Card`.

Методы:
- `constructor(item: IItem, element: HTMLButtonElement)` - метод создает полностью заполненную карточку с установленным слушателем.

#### Класс CardFull
Класс для отображения подробной информации выбранной карточки товара в модальном окне. Расширяет класс `Card`.

Методы:
- `constructor(item: IItem, element: HTMLButtonElement)` - метод создает полностью заполненную карточку с установленным слушателем.
- `toggleButtonText(isInBasket: boolean): void` - меняет надпись кнопки добавления товара в корзину в зависимости от наличия товара в корзине.
- `clearEventListner(): void` - метод снимает обработчик событий с кнопки карточки. Вызывается при закрытии модального окна.

#### Класс CardBasket
Класс для отображения краткой информации из карточек товара в модальном окне корзины пользователя. Расширяет класс `Card`.

Методы:
- `constructor(item: IItem, element: HTMLButtonElement, counter: number)` - метод создает полностью заполненную карточку с установленным слушателем и корректным порядковым номером карточки для отображения в списке.
- `clearEventListner(): void` - метод снимает обработчик событий с кнопки карточки. Вызывается при удалении карточки из корзины.

Поля класса:
- `counter: number` - информация о номере карточки, передаваемая из вызвавшей конструктор функции.
- `basketIndex: HTMLButtonElement` - элемент для отображения номера карточки.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по `Esc`, на клик в оверлей и кнопку-крестик для закрытия попапа.  

Методы:
- `constructor(element: HTMLElement, events: IEvents)` - конструктор принимает элемент конкретного модального окна. Класс расширяет `EventEmitter` для инициации событий.
- `display(): void` - метод отображения модального окна.
- `hide(): void` - метод закрытия модального окна.
- `updateContainer(item: HTMLElement): void` - метод, обновляющий содержимое модального окна.

Поля класса:
- `modal: HTMLElement` - элемент модального окна.
- `cross: HTMLButtonElement` - элемент кнопки закрытия модального окна.
- `container: HTMLElement` -  элемент модального окна для размещения контента из темплейтов.

#### Класс ModalBasket
Расширяет класс `Modal`. Предназначен для реализации модального окна корзины товаров пользователя.

Методы:
- `constructor(element: HTMLElement)` - конструктор принимает элемент модального окна для отображения товаров в корзине пользователя.
- `updateContent(items: HTMLElement[]): void` - метод заполняет поле модального окна корзины карточками товаров.
- `setAsEmpty(): void` - делает кнопку перехода к оформлению неактивной и отображает уведомление пустой корзины.
- `setAsFilled(): void` - делает кнопку перехода к оформлению активной и скрывает уведомление пустой корзины.
- `updateBasketPrice(sum: number): void` - метод пересчитывает сумму стоимости товаров в корзине.

Поля класса:
- `container: HTMLElement` - элемент модального окна для размещения списка карточек товаров.
- `emptyMessage: HTMLElement` - замещающий текст пустой корзины.
- `proceedButton: HTMLButtonElement` - кнопка перехода к оформлению заказа.
- `basketPrice: number` - сумма стоимости товаров в корзине.

#### Класс ModalSuccess
Расширяет класс `Modal`. Предназначен для реализации модального окна с информацией об успешном оформлении заказа.

Методы:
- `constructor(element: HTMLElement)` - конструктор принимает элемент модального окна подтверждения оформления заказа.

Поля класса:
- `priceElement: HTMLElement` - элемент для отображения информации о списанных средствах. 
- `confirmButton: HTMLButtonElement` - основная кнопка, закрывающая модальное окно при нажатии. 

#### Класс Form
Абстрактный класс формы пользовательского ввода. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении в полях ввода инициирует событие изменения данных заказа. Предоставляет методы для отображения ошибок и управления активностью кнопки отправки формы.

Методы:
- `constructor(element: HTMLElement)` - конструктор принимает элемент формы, созданной из темплейта. Класс расширяет `EventEmitter` для инициации событий.
- `displayErrorMessage(message: string): void` - метод выводит переданное сообщение об ошибке формы.
- `clearErrorMessage(): void` - метод очищает сообщение об ошибке формы.
- `enableSubmitButton(): void` - метод делает кнопку сабмита формы активной.
- `disableSubmitButton(): void` - метод делает кнопку сабмита формы неактивной.
- `render(): HTMLElement` - метод возвращает форму.

Поля класса:
- `form: HTMLElement` - элемент формы.
- `submitButton: HTMLButtonElement` - кнопка отправки формы.
- `errorMessage: HTMLElement` - элемент, отображающий текст ошибки.

#### Класс OrderForm
Класс для отображения формы с информацией о способе оплаты и адресе доставки. При сабмите осуществляет переход к следующей форме `ContactsForm`. Расширяет класс `Form`.

Методы:
- `constructor(element: HTMLElement, orderInfo: IOrderInfo)` - конструктор принимает элемент формы, созданной из темплейта, и сохраненные данные заказа.
- `updateButtonSelection(paymentMethod: PaymentMethod): void` - метод принимает выбранный тип оплаты из данных и на его основании делает активной соответствующую кнопку метода оплаты в форме. Деактивирует другую кнопку метода оплаты.

Поля класса:
- `buttonCard: HTMLButtonElement` - кнопка формы для выбора способа оплаты онлайн.
- `buttonCash: HTMLButtonElement` - кнопка формы для выбора способа оплаты при получении.
- `address: HTMLFormElement` - поле формы для ввода адреса доставки.

#### Класс ContactsForm
Класс для отображения формы с информацией об электронной почте и телефоне пользователя. При сабмите осуществляет отправку данных о заказе на сервер. Расширяет класс `Form`.

Методы:
- `constructor(element: HTMLElement, orderInfo: IOrderInfo)` - конструктор принимает элемент формы, созданной из темплейта, и сохраненные данные заказа.

Поля класса:
- `email: HTMLFormElement` - поле формы для ввода электронной почты.
- `phone: HTMLFormElement` - поле формы для ввода телефона.

### Слой коммуникации

#### Класс AppApi
Расширяет класс `Api` и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

Методы:
- `constructor(baseApi: IApi)` - конструктор принимает экземпляр базового класса `Api`.
- `getItems(): Promise<IItem[]>` - метод, используемый для отправки запросов `GET` на сервер для получения данных в виде промиса.
- `postOrderInfo(orderInfo: IOrderInfo, total: number, items: string[]): Promise<IOrderInfo>` - метод для отправки запросов `POST` на сервер для передачи необходимых данных.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью инстансов брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `orderInfoData:changed` - изменение данных с информацией о заказе.
- `basketData:changed` - изменение данных корзины товаров.

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basketButton:click` - событие, возникающее при нажатии на иконку корзины в шапке сайта.
- `cardMain:click` - событие, возникающее при нажатии на карточку товара на главной странице.
- `cardFull:toggle` - событие, возникающее при нажатии на кнопку добавления товара в корзину в расширенной карточке товара.
- `cardBasket:delete` - событие, возникающее при нажатии на кнопку удаления товара из корзины в карточке товара для модального окна содержимого корзины.
- `modalCard:close` - событие, возникающее при попытке закрыть модальное окно карточки товара любым из способов (нажатием на крест, на задний фон модального окна или на клавишу `Esc` на клавиатуре).
- `modalBasket:close` - событие, возникающее при попытке закрыть модальное окно с содержимым корзины любым из способов (нажатием на крест, на задний фон модального окна или на клавишу `Esc` на клавиатуре).
- `modalWithForm:close` - событие, возникающее при попытке закрыть модальное окно с формами ввода любым из способов (нажатием на крест, на задний фон модального окна или на клавишу `Esc` на клавиатуре).
- `modalSuccess:close` - событие, возникающее при попытке закрыть модальное окно подтверждения успешной оплаты любым из способов (нажатием на крест, на задний фон модального окна, на клавишу `Esc` на клавиатуре или нажатием на основную кнопку модального окна).
- `modalBasket:proceed` - событие, возникающее при нажатии на основную кнопку модального окна с содержимым корзины.
- `orderForm:input` - событие, возникающее при вводе пользовательских данных в форму с данными о способе оплаты и адресе доставки.
- `orderForm:submit` - событие, возникающее при сабмите формы с данными о способе оплаты и адресе доставки.
- `contactsForm:input` - событие, возникающее при вводе пользовательских данных в форму с данными об электронной почте и телефоне пользователя.
- `contactsForm:submit` - событие, возникающее при сабмите формы с данными об электронной почте и телефоне пользователя.